fileFormatVersion: 2
guid: e316eb0a15bed22428ac732987aab222
importerOverride: ZEPETO.Script.Compiler:ZEPETO.Script:TypescriptAssetImporter
ScriptedImporter:
  internalIDToNameTable: []
  externalObjects: {}
  serializedVersion: 2
  userData: 
  assetBundleName: 
  assetBundleVariant: 
  script: {fileID: -1123457745, guid: 54cf806323ffe4418a4ce4cc63fe6b9d, type: 3}
  isAssemblyDeclarations: 0
  assembly: 
  generateAllTypes: 1
  types: []
  generateWrapper: 0
  overrideWrapperTypes: 0
  wrapperTypes: []
  WrapperFilters: []
  wrapperOutputDirectory: Generated
  compiledResult: '{"source":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\",
    { value: true });\r\nconst ZEPETO_Script_1 = require(\"ZEPETO.Script\");\r\nconst
    UnityEngine_UI_1 = require(\"UnityEngine.UI\");\r\nconst UnityEngine_1 = require(\"UnityEngine\");\r\nconst
    ZEPETO_Product_1 = require(\"ZEPETO.Product\");\r\nconst ZEPETO_World_1 = require(\"ZEPETO.World\");\r\nconst
    ZEPETO_Multiplay_1 = require(\"ZEPETO.Multiplay\");\r\nconst BalanceManager_1
    = require(\"./Shop/BalanceManager\");\r\nclass ItemManager extends ZEPETO_Script_1.ZepetoScriptBehaviour
    {\r\n    constructor() {\r\n        super(...arguments);\r\n        this._foodCache
    = [];\r\n        this._upgradeCache = [];\r\n        this._cardCache = [];\r\n   
    }\r\n    static GetInstance() {\r\n        if (!ItemManager.Instance) {\r\n           
    //Debug.LogError(\"ItemManager\");\r\n            var _obj = UnityEngine_1.GameObject.Find(\"Managers\");\r\n           
    if (!_obj) {\r\n                _obj = new UnityEngine_1.GameObject(\"Managers\");\r\n               
    _obj.AddComponent($typeof(ItemManager));\r\n            }\r\n            ItemManager.Instance
    = _obj.GetComponent($typeof(ItemManager));\r\n            UnityEngine_1.GameObject.DontDestroyOnLoad(_obj);\r\n       
    }\r\n        return ItemManager.Instance;\r\n    }\r\n    Awake() {\r\n       
    if (this != ItemManager.GetInstance())\r\n            UnityEngine_1.GameObject.Destroy(this.gameObject);\r\n   
    }\r\n    Start() {\r\n        //this.RefreshAllBalanceUI();\r\n        //this.RefreshStageUI();\r\n       
    this._multiplay = UnityEngine_1.Object.FindObjectOfType($typeof(ZEPETO_World_1.ZepetoWorldMultiplay));\r\n       
    this.StartCoroutine(this.LoadAllItems());\r\n        this._multiplay.add_RoomJoined((room)
    => {\r\n            this._room = room;\r\n            this.InitMessageHandler();\r\n       
    });\r\n    }\r\n    InitMessageHandler() {\r\n        // log message handler\r\n       
    this._room.AddMessageHandler(\"SyncBalances\", (message) => {\r\n           
    this.OpenInformation(`${message.currencyId} a Increase or decrease: ${message.quantity}`);\r\n       
    });\r\n        this._multiplay.Room.AddMessageHandler(\"SyncInventories\", (message)
    => {\r\n            this.OpenInformation(`${message.productId} has been ${BalanceManager_1.InventoryAction[message.inventoryAction]}
    in the inventory.`);\r\n            // item use sample\r\n            /*if(message.inventoryAction
    == InventoryAction.Used){\r\n                if(message.productId == \"potion1\"){\r\n                   
    console.log(\"potion use!\");\r\n                }\r\n            }*/\r\n       
    });\r\n        this._room.AddMessageHandler($typeof($typeof(\"System.String\")),
    \"DebitError\", (message) => {\r\n            this.OpenInformation(message);\r\n       
    });\r\n        ZEPETO_Product_1.ProductService.OnPurchaseCompleted.AddListener((product,
    response) => {\r\n            this.OpenInformation(`${response.productId} Purchase
    Completed`);\r\n        });\r\n        ZEPETO_Product_1.ProductService.OnPurchaseFailed.AddListener((product,
    response) => {\r\n            this.OpenInformation(response.message);\r\n       
    });\r\n    }\r\n    *LoadAllItems() {\r\n        const request = ZEPETO_Product_1.ProductService.GetProductsAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            request.responseData.products.forEach((pr)
    => {\r\n                // Determine the prefix of the productId and add the
    product to the appropriate map.\r\n                if (pr.ProductStatus == ZEPETO_Product_1.ProductStatus.Active)
    {\r\n                    const prefix = pr.productId.split(''_'')[0];\r\n                   
    switch (prefix) {\r\n                        case BalanceManager_1.ItemType.food:\r\n                           
    this._foodCache.push(pr);\r\n                            break;\r\n                       
    case BalanceManager_1.ItemType.upgrade:\r\n                            this._upgradeCache.push(pr);\r\n                           
    break;\r\n                        case BalanceManager_1.ItemType.card:\r\n                           
    this._cardCache.push(pr);\r\n                            break;\r\n                       
    default:\r\n                            // Ignore products with unrecognized
    prefixes.\r\n                            break;\r\n                    }\r\n               
    }\r\n            });\r\n        }\r\n        // this.StartCoroutine(this.RefreshInventoryUI());\r\n       
    // this.StartCoroutine(this.RefreshBalanceUI());\r\n    }\r\n    getFoodCache()
    {\r\n        return this._foodCache;\r\n    }\r\n    getUpgradeCache() {\r\n       
    return this._upgradeCache;\r\n    }\r\n    getCardCache() {\r\n        return
    this._cardCache;\r\n    }\r\n    // public RefreshAllBalanceUI(){\r\n    //    
    this.StartCoroutine(this.RefreshBalanceUI());\r\n    // }\r\n    // private *RefreshBalanceUI(){\r\n   
    //     const request = CurrencyService.GetUserCurrencyBalancesAsync();\r\n   
    //     yield new WaitUntil(()=>request.keepWaiting == false);\r\n    //     if(request.responseData.isSuccess)
    {\r\n    //         this.possessionMoneyTxt.text = request.responseData.currencies?.ContainsKey(Currency.wak)
    ? request.responseData.currencies?.get_Item(Currency.wak).toString() :\"0\";\r\n   
    //     }\r\n    // }\r\n    OpenInformation(message) {\r\n        const inforObj
    = UnityEngine_1.GameObject.Instantiate(this.informationPref, this.transform.parent);\r\n       
    inforObj.GetComponentInChildren($typeof(UnityEngine_UI_1.Text)).text = message;\r\n   
    }\r\n    // public GainBalance(currencyId: string, quantity: number) {\r\n   
    //     const data = new RoomData();\r\n    //     data.Add(\"currencyId\", currencyId);\r\n   
    //     data.Add(\"quantity\", quantity);\r\n    //     this._multiplay.Room?.Send(\"onCredit\",
    data.GetObject());\r\n    //     console.warn(\"GainBalance\");\r\n    // }\r\n   
    // public UseBalance(currencyId: string, quantity: number) {\r\n    //     const
    data = new RoomData();\r\n    //     data.Add(\"currencyId\", currencyId);\r\n   
    //     data.Add(\"quantity\", quantity);\r\n    //     this._multiplay.Room?.Send(\"onDebit\",
    data.GetObject());\r\n    //     console.warn(\"UseBalance\");\r\n    // }\r\n   
    // an immediate purchase\r\n    *PurchaseItemImmediately(productId) {\r\n       
    const request = ZEPETO_Product_1.ProductService.PurchaseProductAsync(productId);\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            // is purchase success\r\n       
    }\r\n        else {\r\n            // is purchase fail\r\n        }\r\n    }\r\n   
    *PurchaseItem(productId) {\r\n        const request = ZEPETO_Product_1.ProductService.PurchaseProductAsync(productId);\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            // is purchase success\r\n       
    }\r\n        else {\r\n            // is purchase fail\r\n        }\r\n    }\r\n   
    // public GetProduct(productId: string): ProductRecord | undefined {\r\n    //    
    const prefix = productId.split(''_'')[0];\r\n    //     switch (prefix) {\r\n   
    //         case ItemType.food:\r\n    //             return this._foodCache.get(productId);\r\n   
    //         case ItemType.upgrade:\r\n    //             return this._upgradeCache.get(productId);\r\n   
    //         case ItemType.card:\r\n    //             return this._cardCache.get(productId);\r\n   
    //         default:\r\n    //             return undefined; // Return undefined
    for products with unrecognized prefixes.\r\n    //     }\r\n    // }\r\n    *BtnInterval(btn)
    {\r\n        btn.interactable = false;\r\n        yield new UnityEngine_1.WaitForSeconds(0.2);\r\n       
    btn.interactable = true;\r\n    }\r\n}\r\nexports.default = ItemManager;\r\n//#
    sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSXRlbU1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJJdGVtTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlEQUFxRDtBQUNyRCxtREFBNkM7QUFDN0MsNkNBQWtGO0FBQ2xGLG1EQUF5RztBQUV6RywrQ0FBb0Q7QUFDcEQsdURBQWtEO0FBQ2xELDBEQUFxSDtBQUVySCxNQUFxQixXQUFZLFNBQVEscUNBQXFCO0lBQTlEOztRQXFCWSxlQUFVLEdBQW9CLEVBQUUsQ0FBQztRQUNqQyxrQkFBYSxHQUFvQixFQUFFLENBQUM7UUFDcEMsZUFBVSxHQUFvQixFQUFFLENBQUM7SUFxSzdDLENBQUM7SUF6TFUsTUFBTSxDQUFDLFdBQVc7UUFFckIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLEVBQUU7WUFDdkIsZ0NBQWdDO1lBRWhDLElBQUksSUFBSSxHQUFHLHdCQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxJQUFJLEVBQUU7Z0JBQ1AsSUFBSSxHQUFHLElBQUksd0JBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDbEMsSUFBSSxDQUFDLFlBQVksU0FBQyxXQUFXLEdBQUk7YUFDcEM7WUFDRCxXQUFXLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxZQUFZLFNBQUMsV0FBVyxFQUFHLENBQUM7WUFDeEQsd0JBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN0QztRQUNELE9BQU8sV0FBVyxDQUFDLFFBQVEsQ0FBQztJQUNoQyxDQUFDO0lBVUQsS0FBSztRQUNELElBQUksSUFBSSxJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUU7WUFBRSx3QkFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDL0UsQ0FBQztJQUVELEtBQUs7UUFDRCw2QkFBNkI7UUFDN0Isd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxVQUFVLEdBQUcsb0JBQU0s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","assetPath":"Assets/Scripts/ItemManager.ts","manifest":{"properties":[{"assembly":"UnityEngine.CoreModule","name":"informationPref","type":"UnityEngine.GameObject","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]}],"name":"ItemManager","description":""},"isCompiled":true}'
  typescriptHash: 890cb78bd64af6286cc7a79eefd12652
  onlyWriteTrigger: 0

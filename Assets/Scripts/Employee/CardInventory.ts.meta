fileFormatVersion: 2
guid: a05551fcb4f9af7408e43118c9345980
importerOverride: ZEPETO.Script.Compiler:ZEPETO.Script:TypescriptAssetImporter
ScriptedImporter:
  internalIDToNameTable: []
  externalObjects: {}
  serializedVersion: 2
  userData: 
  assetBundleName: 
  assetBundleVariant: 
  script: {fileID: -1123457745, guid: 54cf806323ffe4418a4ce4cc63fe6b9d, type: 3}
  isAssemblyDeclarations: 0
  assembly: 
  generateAllTypes: 1
  types: []
  generateWrapper: 0
  overrideWrapperTypes: 0
  wrapperTypes: []
  WrapperFilters: []
  wrapperOutputDirectory: Generated
  compiledResult: '{"source":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\",
    { value: true });\r\nconst ZEPETO_Script_1 = require(\"ZEPETO.Script\");\r\nconst
    UnityEngine_UI_1 = require(\"UnityEngine.UI\");\r\nconst UnityEngine_1 = require(\"UnityEngine\");\r\nconst
    CardSlot_1 = require(\"./CardSlot\");\r\nconst DataManager_1 = require(\"../DataManager\");\r\nconst
    EquipSlotController_1 = require(\"./EquipSlotController\");\r\nclass CardInventory
    extends ZEPETO_Script_1.ZepetoScriptBehaviour {\r\n    constructor() {\r\n       
    super(...arguments);\r\n        this.cardSlots = [];\r\n    }\r\n    Start()
    {\r\n        this.Init();\r\n        const inventoryCache = DataManager_1.default.GetInstance().GetInventoryCache();\r\n       
    this.CreateInventory(inventoryCache);\r\n        this.equipSlotController = this.equipSlotControllerObj.GetComponent($typeof(EquipSlotController_1.default));\r\n   
    }\r\n    Init() {\r\n        // ProductService.OnPurchaseCompleted.AddListener((product,
    response) => {\r\n        //     this.RefreshInventoryUI()\r\n        // });\r\n       
    // this._room.AddMessageHandler<InventorySync>(\"SyncInventories\", (message)
    => {\r\n        //     this.RefreshInventoryUI()\r\n        // });\r\n       
    this.equipBtn.onClick.AddListener(() => this.OnClickEquipCard());\r\n    }\r\n   
    RefreshInventoryUI() {\r\n        const existingIds = [];\r\n        const inventoryCache
    = DataManager_1.default.GetInstance().GetInventoryCache();\r\n        // Update
    existing slots\r\n        this.cardSlots.forEach((cardSlot) => {\r\n           
    const cardId = cardSlot.GetCardData().GetCardId();\r\n            const quantity
    = inventoryCache.get(cardId) || 0;\r\n            if (quantity > 0) {\r\n               
    cardSlot.RefreshItem(quantity);\r\n                existingIds.push(cardId);\r\n           
    }\r\n            else {\r\n                cardSlot.ClearSlot();\r\n               
    cardSlot.gameObject.SetActive(false);\r\n            }\r\n        });\r\n       
    // Add new slots for cards that were not already displayed\r\n        for (const
    [id, quantity] of inventoryCache) {\r\n            if (!existingIds.includes(id))
    {\r\n                this.CreateSlot(id, quantity);\r\n            }\r\n       
    }\r\n    }\r\n    CreateInventory(inventoryCache) {\r\n        this.contentParent.GetComponentsInChildren($typeof(CardSlot_1.default)).forEach((child)
    => {\r\n            UnityEngine_1.GameObject.Destroy(child.gameObject);\r\n       
    });\r\n        /*Sort by Create Order (descending order)*/\r\n        for (const
    [id, quantity] of inventoryCache) {\r\n            //if (quantity > 0)\r\n           
    this.CreateSlot(id, quantity);\r\n        }\r\n        // Update the size of
    the content to fit the number of slots\r\n        const layoutGroup = this.contentParent.GetComponent($typeof(UnityEngine_UI_1.GridLayoutGroup));\r\n       
    const cellSize = layoutGroup.cellSize;\r\n        const spacing = layoutGroup.spacing;\r\n       
    const constraintCount = layoutGroup.constraintCount;\r\n        const rowCount
    = Math.ceil(this.cardSlots.length / constraintCount);\r\n        // Cast contentParent
    to RectTransform\r\n        const contentRectTransform = this.contentParent.transform;\r\n       
    const newContentSize = new UnityEngine_1.Vector2(contentRectTransform.sizeDelta.x,
    (rowCount + 1) * (cellSize.y + spacing.y));\r\n        contentRectTransform.sizeDelta
    = newContentSize;\r\n    }\r\n    CreateSlot(id, quantity) {\r\n        const
    cardObj = UnityEngine_1.Object.Instantiate(this.cardSlotPrefab, this.contentParent);\r\n       
    const slot = cardObj.GetComponent($typeof(CardSlot_1.default));\r\n        const
    cardData = DataManager_1.default.GetInstance().GetCardData(id);\r\n        slot.SetSlot(cardData,
    quantity);\r\n        //slot.IsOn(false);\r\n        this.cardSlots.push(slot);\r\n   
    }\r\n    OnClickEquipCard() {\r\n        const toggleGroup = this.contentParent.GetComponent($typeof(UnityEngine_UI_1.ToggleGroup));\r\n       
    const card = toggleGroup.GetFirstActiveToggle()?.GetComponent($typeof(CardSlot_1.default)).GetCardData();\r\n       
    if (ZEPETO_Script_1.ZepetoScriptBehaviour.op_Equality(card, null)) {\r\n           
    console.warn(\"no have card data\");\r\n            return;\r\n        }\r\n       
    this.equipSlotController.EquipCharacter(card);\r\n        console.log(\"OnClickEquipCard:
    \" + card.GetCardId());\r\n    }\r\n}\r\nexports.default = CardInventory;\r\n//#
    sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FyZEludmVudG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNhcmRJbnZlbnRvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBbUQ7QUFDbkQsbURBQXFFO0FBQ3JFLDZDQUFtRjtBQUluRix5Q0FBa0M7QUFDbEMsZ0RBQXlDO0FBQ3pDLCtEQUF3RDtBQUV4RCxNQUFxQixhQUFjLFNBQVEscUNBQXFCO0lBQWhFOztRQU9ZLGNBQVMsR0FBZSxFQUFFLENBQUM7SUE4RnZDLENBQUM7SUEzRlcsS0FBSztRQUNULElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNaLE1BQU0sY0FBYyxHQUFHLHFCQUFXLENBQUMsV0FBVyxFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUNyRSxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsWUFBWSxTQUFDLDZCQUFtQixFQUFHLENBQUM7SUFDL0YsQ0FBQztJQUVPLElBQUk7UUFDUiwwRUFBMEU7UUFDMUUsZ0NBQWdDO1FBQ2hDLE1BQU07UUFDTixnRkFBZ0Y7UUFDaEYsZ0NBQWdDO1FBQ2hDLE1BQU07UUFDTixJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsR0FBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRU8sa0JBQWtCO1FBQ3RCLE1BQU0sV0FBVyxHQUFhLEVBQUUsQ0FBQztRQUNqQyxNQUFNLGNBQWMsR0FBRyxxQkFBVyxDQUFDLFdBQVcsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDckUsd0JBQXdCO1FBQ3hCLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDaEMsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFD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","assetPath":"Assets/Scripts/Employee/CardInventory.ts","manifest":{"properties":[{"assembly":"UnityEngine.UI","name":"equipBtn","type":"UnityEngine.UI.Button","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.UI","name":"upgradeBtn","type":"UnityEngine.UI.Button","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.CoreModule","name":"contentParent","type":"UnityEngine.Transform","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.CoreModule","name":"equipSlotControllerObj","type":"UnityEngine.GameObject","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.CoreModule","name":"cardSlotPrefab","type":"UnityEngine.GameObject","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]}],"name":"CardInventory","description":""},"isCompiled":true}'
  typescriptHash: d625890ab0430b363cb1c52270bfbc5d
  onlyWriteTrigger: 0

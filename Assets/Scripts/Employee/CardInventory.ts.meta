fileFormatVersion: 2
guid: a05551fcb4f9af7408e43118c9345980
importerOverride: ZEPETO.Script.Compiler:ZEPETO.Script:TypescriptAssetImporter
ScriptedImporter:
  internalIDToNameTable: []
  externalObjects: {}
  serializedVersion: 2
  userData: 
  assetBundleName: 
  assetBundleVariant: 
  script: {fileID: -1123457745, guid: 54cf806323ffe4418a4ce4cc63fe6b9d, type: 3}
  isAssemblyDeclarations: 0
  assembly: 
  generateAllTypes: 1
  types: []
  generateWrapper: 0
  overrideWrapperTypes: 0
  wrapperTypes: []
  WrapperFilters: []
  wrapperOutputDirectory: Generated
  compiledResult: '{"source":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\",
    { value: true });\r\nconst ZEPETO_Script_1 = require(\"ZEPETO.Script\");\r\nconst
    UnityEngine_UI_1 = require(\"UnityEngine.UI\");\r\nconst UnityEngine_1 = require(\"UnityEngine\");\r\nconst
    ZEPETO_Inventory_1 = require(\"ZEPETO.Inventory\");\r\nconst ZEPETO_Product_1
    = require(\"ZEPETO.Product\");\r\nconst ZEPETO_World_1 = require(\"ZEPETO.World\");\r\nconst
    ZEPETO_Multiplay_1 = require(\"ZEPETO.Multiplay\");\r\nconst CardSlot_1 = require(\"./CardSlot\");\r\nclass
    CardInventory extends ZEPETO_Script_1.ZepetoScriptBehaviour {\r\n    constructor()
    {\r\n        super(...arguments);\r\n        this._productCache = new Map();\r\n   
    }\r\n    Start() {\r\n        this._multiplay = UnityEngine_1.Object.FindObjectOfType($typeof(ZEPETO_World_1.ZepetoWorldMultiplay));\r\n       
    this._multiplay.add_RoomJoined((room) => {\r\n            this._room = room;\r\n           
    this.InitMessageHandler();\r\n        });\r\n        this.StartCoroutine(this.LoadAllItems());\r\n   
    }\r\n    InitMessageHandler() {\r\n        ZEPETO_Product_1.ProductService.OnPurchaseCompleted.AddListener((product,
    response) => {\r\n            this.StartCoroutine(this.RefreshInventoryUI());\r\n       
    });\r\n        this._room.AddMessageHandler(\"SyncInventories\", (message) =>
    {\r\n            this.StartCoroutine(this.RefreshInventoryUI());\r\n        });\r\n       
    this.useBtn.onClick.AddListener(() => this.OnClickEquipCard());\r\n    }\r\n   
    *LoadAllItems() {\r\n        const request = ZEPETO_Product_1.ProductService.GetProductsAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            request.responseData.products.forEach((pr)
    => {\r\n                this._productCache.set(pr.productId, pr);\r\n           
    });\r\n        }\r\n        this.StartCoroutine(this.RefreshInventoryUI());\r\n   
    }\r\n    *RefreshInventoryUI() {\r\n        const request = ZEPETO_Inventory_1.InventoryService.GetListAsync();\r\n       
    yield new UnityEngine_1.WaitUntil(() => request.keepWaiting == false);\r\n       
    if (request.responseData.isSuccess) {\r\n            const items = request.responseData.products;\r\n           
    items.forEach((ir, index) => {\r\n                // If there are zero consumable
    items, delete them from the inventory.\r\n                if (ir.quantity <=
    0 && this._productCache.get(ir.productId).PurchaseType == ZEPETO_Product_1.PurchaseType.Consumable)
    {\r\n                    // remove inventory\r\n                    const data
    = new ZEPETO_Multiplay_1.RoomData();\r\n                    data.Add(\"productId\",
    ir.productId);\r\n                    this._multiplay.Room?.Send(\"onRemoveInventory\",
    data.GetObject());\r\n                    return;\r\n                }\r\n           
    });\r\n            // If the value matches the previously received value, do
    not update it.\r\n            if (this._inventoryCache === items)\r\n               
    return;\r\n            else if (items != null && this._inventoryCache?.length
    == items.length)\r\n                this.UpdateInventory(items);\r\n           
    else\r\n                this.CreateInventory(items);\r\n            this.usedSlotNumTxt.text
    = items.length.toString();\r\n            this._inventoryCache = items;\r\n       
    }\r\n    }\r\n    UpdateInventory(items) {\r\n        const itemScripts = this.contentParent.GetComponentsInChildren($typeof(CardSlot_1.default));\r\n       
    items.forEach((ir) => {\r\n            itemScripts.forEach((itemScript) => {\r\n               
    if (itemScript.itemRecord.productId == ir.productId) {\r\n                   
    const isShowQuantity = this._productCache.get(ir.productId).PurchaseType == ZEPETO_Product_1.PurchaseType.Consumable;\r\n                   
    itemScript.RefreshItem(ir, isShowQuantity);\r\n                    return;\r\n               
    }\r\n            });\r\n        });\r\n    }\r\n    CreateInventory(items) {\r\n       
    this.contentParent.GetComponentsInChildren($typeof(CardSlot_1.default)).forEach((child)
    => {\r\n            UnityEngine_1.GameObject.Destroy(child.gameObject);\r\n       
    });\r\n        // Sort by Create Order (descending order)\r\n        items.sort((a,
    b) => b.createdAt.getTime() - a.createdAt.getTime());\r\n        items.forEach((ir,
    index) => {\r\n            const itemObj = UnityEngine_1.Object.Instantiate(this.prefItem,
    this.contentParent);\r\n            const itemScript = itemObj.GetComponent($typeof(CardSlot_1.default));\r\n           
    this.itemImage.forEach((s, index) => {\r\n                // Import by name comparison
    from image resources.\r\n                if (s.name == ir.productId) {\r\n                   
    itemScript.itemImage.sprite = this.itemImage[index];\r\n                    return;\r\n               
    }\r\n            });\r\n            // Non-consumable items do not display numbers.\r\n           
    const isShowQuantity = this._productCache.get(ir.productId).PurchaseType == ZEPETO_Product_1.PurchaseType.Consumable;\r\n           
    itemScript.RefreshItem(ir, isShowQuantity);\r\n            itemScript.isOn(index
    == 0);\r\n        });\r\n    }\r\n    OnClickEquipCard() {\r\n        const toggleGroup
    = this.contentParent.GetComponent($typeof(UnityEngine_UI_1.ToggleGroup));\r\n       
    const item = toggleGroup.GetFirstActiveToggle()?.GetComponent($typeof(CardSlot_1.default)).itemRecord;\r\n       
    if (item == null) {\r\n            console.warn(\"no have item data\");\r\n           
    return;\r\n        }\r\n        if (this._multiplay.Room == null) {\r\n           
    console.warn(\"server disconnect\");\r\n            return;\r\n        }\r\n       
    const data = new ZEPETO_Multiplay_1.RoomData();\r\n        data.Add(\"productId\",
    item.productId);\r\n        data.Add(\"quantity\", 1);\r\n        this._multiplay.Room?.Send(\"onUseInventory\",
    data.GetObject());\r\n    }\r\n}\r\nexports.default = CardInventory;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FyZEludmVudG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNhcmRJbnZlbnRvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpREFBbUQ7QUFDbkQsbURBQXdEO0FBQ3hELDZDQUE0RTtBQUM1RSx1REFBbUU7QUFFbkUsbURBQTJFO0FBQzNFLCtDQUFrRDtBQUNsRCx1REFBZ0Q7QUFFaEQseUNBQWtDO0FBRWxDLE1BQXFCLGFBQWMsU0FBUSxxQ0FBcUI7SUFBaEU7O1FBVVksa0JBQWEsR0FBK0IsSUFBSSxHQUFHLEVBQXlCLENBQUM7SUEySHpGLENBQUM7SUF2SFcsS0FBSztRQUNULElBQUksQ0FBQyxVQUFVLEdBQUcsb0JBQU0sQ0FBQyxnQkFBZ0IsU0FBQyxtQ0FBb0IsRUFBRyxDQUFDO1FBQ2xFLElBQUksQ0FBQyxVQUFVLGdCQUFlLENBQUMsSUFBVSxFQUFFLEVBQUU7WUFDekMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFDbEIsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDOUIsQ0FBQyxFQUFBO1FBQ0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRU8sa0JBQWtCO1FBQ3RCLCtCQUFjLENBQUMsbUJBQW1CLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUFFO1lBQ2pFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQWdCLGlCQUFpQixFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDdkUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLE1B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","assetPath":"Assets/Scripts/Employee/CardInventory.ts","manifest":{"properties":[{"assembly":"UnityEngine.UI","name":"usedSlotNumTxt","type":"UnityEngine.UI.Text","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.UI","name":"possessionStarTxt","type":"UnityEngine.UI.Text","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.UI","name":"useBtn","type":"UnityEngine.UI.Button","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.CoreModule","name":"contentParent","type":"UnityEngine.Transform","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.CoreModule","name":"prefItem","type":"UnityEngine.GameObject","isArray":false,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]},{"assembly":"UnityEngine.CoreModule","name":"itemImage","type":"UnityEngine.Sprite[]","isArray":true,"initValue":[],"enumKeys":[],"enumValues":[],"attributes":[{"name":"SerializeField","args":[]}]}],"name":"CardInventory","description":""},"isCompiled":true}'
  typescriptHash: ba7b96250fb3f6905988f9b072efcca5
  onlyWriteTrigger: 0
